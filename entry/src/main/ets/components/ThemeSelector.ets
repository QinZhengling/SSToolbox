/*
 * ä¸»é¢˜é€‰æ‹©å™¨ç»„ä»¶
 */

import { ThemeManager, ThemeConfig, ThemeUtils } from '../theme/AppTheme';

@Component
export struct ThemeSelector {
  @State isVisible: boolean = false;
  @State currentThemeName: string = 'spring';
  
  // ä¸»é¢˜åˆ‡æ¢å›žè°ƒ
  private onThemeChange?: (themeName: string) => void;
  
  // æž„å»ºä¸»é¢˜é€‰é¡¹
  @Builder
  ThemeOption(theme: ThemeConfig, index: number) {
    Column({ space: 8 }) {
      // ä¸»é¢˜é¢œè‰²é¢„è§ˆ
      Row() {
        // ä¸»è‰²è°ƒé¢„è§ˆ
        Column()
          .width(24)
          .height(24)
          .backgroundColor(theme.colors.primary)
          .borderRadius(12)
        
        // å¼ºè°ƒè‰²é¢„è§ˆ
        Column()
          .width(24)
          .height(24)
          .backgroundColor(theme.colors.secondary)
          .borderRadius(12)
          .margin({ left: 4 })
        
        // è¾…åŠ©è‰²é¢„è§ˆ
        Column()
          .width(24)
          .height(24)
          .backgroundColor(theme.colors.accent)
          .borderRadius(12)
          .margin({ left: 4 })
      }
      
      // ä¸»é¢˜åç§°
      Text(this.getThemeDisplayName(theme.name))
        .fontSize(14)
        .fontColor(this.currentThemeName === theme.name ? theme.colors.primary : '#666666')
        .fontWeight(this.currentThemeName === theme.name ? FontWeight.Bold : FontWeight.Normal)
    }
    .width(120)
    .height(80)
    .backgroundColor(this.currentThemeName === theme.name ? theme.colors.surface : '#F5F5F5')
    .borderRadius(12)
    .border({
      width: this.currentThemeName === theme.name ? 2 : 1,
      color: this.currentThemeName === theme.name ? theme.colors.primary : '#E0E0E0'
    })
    .padding(12)
    .onClick(() => {
      this.currentThemeName = theme.name;
      ThemeManager.setTheme(theme.name);
      if (this.onThemeChange) {
        this.onThemeChange(theme.name);
      }
      this.isVisible = false;
    })
  }
  
  // èŽ·å–ä¸»é¢˜æ˜¾ç¤ºåç§°
  private getThemeDisplayName(themeName: string): string {
    switch (themeName) {
      case 'spring': return 'æ˜¥ä¹‹å·´é»Ž';
      case 'summer': return 'å¤æ—¥æµ·æ´‹';
      case 'autumn': return 'é‡‘è‰²ç§‹å¤©';
      case 'winter': return 'å†°é›ªå†¬æ—¥';
      default: return themeName;
    }
  }
  
  build() {
    const theme = ThemeManager.getCurrentTheme();
    
    Column() {
      // ä¸»é¢˜åˆ‡æ¢æŒ‰é’®
      Button('ðŸŽ¨')
        .fontSize(20)
        .width(44)
        .height(44)
        .backgroundColor(theme.colors.surface)
        .fontColor(theme.colors.primary)
        .type(ButtonType.Circle)
        .shadow({
          radius: 8,
          color: 'rgba(0,0,0,0.1)',
          offsetY: 4
        })
        .onClick(() => {
          this.isVisible = !this.isVisible;
        })
      
      // ä¸»é¢˜é€‰æ‹©é¢æ¿
      if (this.isVisible) {
        Column({ space: 12 }) {
          Text('é€‰æ‹©ä¸»é¢˜')
            .fontSize(16)
            .fontWeight(FontWeight.Bold)
            .fontColor(theme.colors.textPrimary)
            .margin({ top: 12 })
          
          // ä¸»é¢˜ç½‘æ ¼
          Grid() {
            ForEach(ThemeManager.getThemes(), (theme: ThemeConfig, index: number) => {
              GridItem() {
                this.ThemeOption(theme, index)
              }
            })
          }
          .columnsTemplate('1fr 1fr')
          .rowsTemplate('1fr 1fr')
          .columnsGap(12)
          .rowsGap(12)
          .width('100%')
          .margin({ top: 12, bottom: 12 })
        }
        .width(280)
        .backgroundColor(theme.colors.background)
        .borderRadius(16)
        .padding(16)
        .shadow({
          radius: 8,
          color: 'rgba(0,0,0,0.1)',
          offsetY: 4
        })
        .margin({ top: 8 })
        .position({ x: -120 })
      }
    }
    .alignItems(HorizontalAlign.Start)
  }
}